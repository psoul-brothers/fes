{% extends 'common/base.html' %}
{% block head %}
    <title>アンケート回答ページ</title>
{% endblock %}
{% block contents %}
<h1>{{ question.question_text }}についての回答</h1>

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}
{% if choices %}
<table border="1">
  <thead>
    <tr>
　    <th>ユーザー</th>
      {% for choice in choices %}
        <th>{{ choice }}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% if user_answers_dict %}
      {% for user, choice_answer in user_answers_dict.iteritems %}
      <tr>
        <td>{{ user.surname }}</td>
        {% for answer in choice_answer.values %}
          <td>{{ answer }}</td>
        {% endfor %}
        <!--  https://qiita.com/tell-k/items/710c79ae9ab47f7a4f7c 
              Choice.objects.values('question').distinct()
              # answer.values("user").filter(question = id).distinct() とか？
              Answer.objects.values("user").filter(question = id).distinct() こんな？
        -->
      </tr>
      {% endfor %}
    {% else %}
    {% endif %}
  </tbody>
    <!--<input type="radio" name="choice" id="choice{{ forloop.counter }}" value="{{ choice.id }}" />-->
    <!--<label for="choice{{ forloop.counter }}">{{ choice.choice_text }}</label><br />-->
</table>
{% endif %}
<form action="{% url 'questions:answerRegistration' question.id %}" method="post">
{% csrf_token %}
<table border="1">
      <thead>
        <tr>
　        <th>ユーザー</th>
        {% for choice in question.choice_set.all %}
          <th>{{ choice.choice_text }}</th>
        {% endfor %}
        </tr>
      </thead>
      <tbody>
          <tr>
            <td>
              {{ request.user.surname  }}
            </td>
            {% for choice in question.choice_set.all %}
            <td>
              <div>
                <input type="hidden" name="choiceId" value="{{choice.id}}"/>
                <!--<label for="answer_text">回答:</label>-->
                <!--{{ form.select_answer.label }}：-->
                <!--{{ form.select_answer }}-->
                <!--{% for radio in form.select_answer  %}-->
                <!--  {{ radio.tag }}-->
                <!--  <label for="answer_text_{{ radio.index }}">{{ radio.choice_label }}</label>-->
                <!--{% endfor %}-->
                <label>○<input type="radio" name="answer_text_{{choice.id}}" id="answer_text" value="○" checked/></label>
                <label>△<input type="radio" name="answer_text_{{choice.id}}" id="answer_text" value="△"/></label>
                <label>×<input type="radio" name="answer_text_{{choice.id}}" id="answer_text" value="×"/></label>
              </div>
            </td>
            {% endfor %}
          </tr>
      </tbody>
</table>
<input type="submit" value="送信" />
</form>
{% endblock %}