{% extends 'common/base.html' %}
{% load is_checked %}
{% block head %}
    <link href="/static/css/question_style.css" rel="stylesheet">
    <title>アンケート回答ページ</title>
{% endblock %}
{% block contents %}
<h1>{{ question.question_text }}</h1>

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

{% if question.get_users %}
<div class="scroll">
<table border="1" class="question">
  <thead>
    <tr>
　    <th></th>
      {% for choice in choices %}
        <th>{{ choice.choice_text }}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% if user_answers_dict %}
      {% for user, choice_answer in user_answers_dict.iteritems %}
      <tr>
        <td>{{ user.surname }}</td>
        {% for answer in choice_answer.values %}
          <td>{{ answer }}</td>
        {% endfor %}
        <!--  https://qiita.com/tell-k/items/710c79ae9ab47f7a4f7c 
              Choice.objects.values('question').distinct()
              # answer.values("user").filter(question = id).distinct() とか？
              Answer.objects.values("user").filter(question = id).distinct() こんな？
        -->
      </tr>
      {% endfor %}
    {% else %}
    {% endif %}
  </tbody>
    <!--<input type="radio" name="choice" id="choice{{ forloop.counter }}" value="{{ choice.id }}" />-->
    <!--<label for="choice{{ forloop.counter }}">{{ choice.choice_text }}</label><br />-->
</table>
</div>
{% else %}
<p>まだだれも回答していません</p>
{% endif %}

<form action="{% url 'questions:answerRegistration' question.id %}" method="post">
{% csrf_token %}
<div class="scroll">
<table border="1" class="question question_input">
      <thead>
        <tr>
　        <th></th>
        {% for choice in choices %}
          <th>{{ choice.choice_text }}</th>
        {% endfor %}
        </tr>
      </thead>
      <tbody>
          <tr>
            <td>
              {{ request.user.surname  }}
            </td>
            {% for choice in question.get_sorted_choices %}
            <td>
              <input type="hidden" name="choiceId" value="{{choice.id}}"/>
              <ul>
                <!--<label for="answer_text">回答:</label>-->
                <!--{{ form.select_answer.label }}：-->
                <!--{{ form.select_answer }}-->
                <!--{% for radio in form.select_answer  %}-->
                <!--  {{ radio.tag }}-->
                <!--  <label for="answer_text_{{ radio.index }}">{{ radio.choice_label }}</label>-->
                <!--{% endfor %}-->
                <li><input type="radio" name="answer_text_{{choice.id}}" id="answer_text_ok_for_{{choice.id}}" value="○" {{choice|get_answer:request.user.id|is_checked:"○"}}/><label for="answer_text_ok_for_{{choice.id}}">○</label></li>
                <li><input type="radio" name="answer_text_{{choice.id}}" id="answer_text_soso_for_{{choice.id}}" value="△" {{choice|get_answer:request.user.id|is_checked:"△"}}/><label for="answer_text_soso_for_{{choice.id}}">△</label></li>
                <li><input type="radio" name="answer_text_{{choice.id}}" id="answer_text_ng_for_{{choice.id}}" value="×" {{choice|get_answer:request.user.id|is_checked:"×"}}/><label for="answer_text_ng_for_{{choice.id}}">×</label></li>
              </ul>
            </td>
            {% endfor %}
          </tr>
      </tbody>
</table>
</div>
<input type="submit" value="送信" />
</form>
{% endblock %}